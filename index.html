<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–µ—à–∞—Ç–µ–ª—å</title>

<style>
*{box-sizing:border-box}

body{
    margin:0;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:system-ui,Arial,sans-serif;
    background:radial-gradient(circle at top,#1b1f2a,#07080d);
    color:#fff
}

.box{
    width:100%;
    max-width:460px;
    background:rgba(20,24,36,.85);
    backdrop-filter:blur(14px);
    border-radius:26px;
    padding:26px;
    box-shadow:0 35px 70px rgba(0,0,0,.75)
}

.grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:14px
}

.card{
    position:relative;
    background:rgba(255,255,255,.04);
    border-radius:18px;
    padding:16px;
    text-align:center
}
.card.full{grid-column:1 / -1}

/* VISUAL */
.visual{
    font-size:60px;
    user-select:none;
    display:inline-block;
    transform-style:preserve-3d;
    perspective:800px;
}

/* BUTTONS */
button{
    width:100%;
    margin-top:8px;
    padding:12px;
    border-radius:14px;
    border:none;
    cursor:pointer;
    font-weight:600;
    color:#eaf0ff;
    background:linear-gradient(135deg,#2a3355,#1a2140);
    box-shadow:0 6px 16px rgba(0,0,0,.45);
    transition:.15s;
}
button:hover{transform:translateY(-1px)}
button:active{transform:translateY(1px)}

.settings-btn{
    position:absolute;
    top:8px;
    right:8px;
    width:auto!important;
    padding:4px 6px;
    font-size:13px;
    border-radius:8px;
    background:rgba(255,255,255,.12);
    color:#fff;
}

.settings{
    display:none;
    margin-top:8px;
    background:rgba(0,0,0,.35);
    padding:8px;
    border-radius:10px;
    font-size:13px;
    text-align:left
}
.settings label{display:block;margin-bottom:6px}

/* ANIMATIONS */
.coin.toss{animation:coinToss 1s ease-in-out}
@keyframes coinToss{
    0%{transform:translateY(0) rotateX(0deg)}
    40%{transform:translateY(-28px) rotateX(720deg)}
    100%{transform:translateY(0) rotateX(1080deg)}
}
.dice.roll{animation:diceToss .95s ease-in-out}
@keyframes diceToss{
    0%{transform:translateY(0) rotate(0deg)}
    40%{transform:translateY(-28px) rotate(720deg)}
    100%{transform:translateY(0) rotate(1080deg)}
}

/* LOGS */
.log{
    margin-top:10px;
    min-height:26px;
    font-size:14px;
    opacity:0;
    transform:translateY(10px);
    transition:.3s;
}
.log.show{opacity:1;transform:translateY(0)}
.movie{color:#ffd66b;font-weight:600}

#wheelLog:empty{display:none}

/* HISTORY */
.history{
    margin-top:12px;
    background:rgba(255,255,255,.04);
    border-radius:14px;
    padding:10px;
    max-height:140px;
    overflow:auto;
    font-size:14px
}
.history-title{text-align:center;font-weight:600;margin-bottom:4px}
.history ul{list-style:none;padding:0;margin:0;text-align:left}
.history li{margin-bottom:4px}

/* —Å—Å—ã–ª–∫–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî –∫–∞–∫ –≤ "–í—ã–ø–∞–ª–æ" */
.history a{
    color:#7cc7ff;
    text-decoration:none;
}
.history a:hover{
    text-decoration:underline;
}

/* –í–´–ü–ê–õ–û */
#lastResult{
    text-align:left;
    font-weight:600;
    color:#fff;
    padding-bottom:6px;
    margin-bottom:8px;
    border-bottom:1px solid rgba(255,255,255,.15);
}
#lastResult span{color:#ffd66b}
#lastResult a{
    color:#7cc7ff;
    text-decoration:none;
}
#lastResult a:hover{
    text-decoration:underline;
}

/* —Å–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
#lastResult:has(span:empty){
    display:none;
}

/* INPUT */
input{
    width:100%;
    margin-top:6px;
    padding:10px 12px;
    border-radius:12px;
    border:none;
    background:rgba(255,255,255,.08);
    color:#fff;
}

/* WHEEL */
.arrow{
    margin:-6px auto 0;
    width:0;height:0;
    border-left:10px solid transparent;
    border-right:10px solid transparent;
    border-top:18px solid #ffd66b
}

.wheel-wrap{
    position:relative;
    width:260px;
    height:260px;
    margin:10px auto;
}

canvas{
    display:block;
    filter:drop-shadow(0 6px 10px rgba(0,0,0,.45));
}

.wheel-sound{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    font-size:22px;
    cursor:pointer;
    opacity:.55;
    z-index:5;
}
.wheel-sound:hover{
    opacity:1;
    transform:translate(-50%,-50%) scale(1.15);
}

.btn-row{display:flex;gap:8px;margin-top:8px}
</style>
</head>

<body>
<div class="box">
<div class="grid">

<!-- COIN -->
<div class="card">
<button class="settings-btn" onclick="toggle('coinSet')">‚öôÔ∏è</button>
<div class="visual coin" id="coin">ü™ô</div>
<div class="settings" id="coinSet">
<label>–û—Ä—ë–ª<input id="eagleText" value="üé¨ –ö–ò–ù–û"></label>
<label>–†–µ—à–∫–∞<input id="tailsText" value="üì∫ YouTube"></label>
</div>
<button onclick="coinFlip()">–ü–û–î–ë–†–û–°–ò–¢–¨</button>
<div class="log" id="coinLog"></div>
</div>

<!-- DICE -->
<div class="card">
<button class="settings-btn" onclick="toggle('diceSet')">‚öôÔ∏è</button>
<div class="visual dice" id="dice">üé≤</div>
<div class="settings" id="diceSet">
<label>–ú–∏–Ω–∏–º—É–º<input id="diceMin" type="number" value="1"></label>
<label>–ú–∞–∫—Å–∏–º—É–º<input id="diceMax" type="number" value="3"></label>
</div>
<button onclick="rollDice()">–ü–û–î–ë–†–û–°–ò–¢–¨</button>
<div class="log" id="diceLog"></div>
</div>

<!-- WHEEL -->
<div class="card full">
<div class="arrow"></div>

<div class="wheel-wrap">
<canvas id="wheel" width="260" height="260"></canvas>
<div class="wheel-sound" id="soundToggle" onclick="toggleSound()">üîä</div>
</div>

<input id="sectorInput" placeholder="–¢–µ–∫—Å—Ç —Å–µ–∫—Ç–æ—Ä–∞">

<div class="btn-row">
<button onclick="addSector()">–î–û–ë–ê–í–ò–¢–¨</button>
<button onclick="resetWheel()">–°–ë–†–û–°</button>
</div>

<button onclick="spinWheel()">–ö–†–£–¢–ò–¢–¨</button>

<div class="log" id="wheelLog"></div>

<div class="history">
<div class="history-title">üìú –ò—Å—Ç–æ—Ä–∏—è</div>
<div id="lastResult">–í—ã–ø–∞–ª–æ: <span></span></div>
<ul id="wheelHistory"></ul>
</div>

</div>
</div>
</div>

<script>
function toggle(id){
    const e=document.getElementById(id);
    e.style.display=e.style.display==='block'?'none':'block';
}
function showLog(id,html){
    const el=document.getElementById(id);
    el.classList.remove('show');
    el.innerHTML=html;
    void el.offsetWidth;
    el.classList.add('show');
}
function isURL(text){
    return /^(https?:\/\/)/i.test(text);
}
function formatLink(text){
    const safe=text.replace(/"/g,'&quot;');
    return `<a href="${safe}" target="_blank" rel="noopener noreferrer">${safe}</a>`;
}

/* SOUND */
const audio=new(window.AudioContext||window.webkitAudioContext)();
let soundEnabled=true;
function toggleSound(){
    soundEnabled=!soundEnabled;
    soundToggle.textContent=soundEnabled?'üîä':'üîá';
}
function clickSound(f=900){
    if(!soundEnabled)return;
    const o=audio.createOscillator(),g=audio.createGain();
    o.frequency.value=f;g.gain.value=.05;
    o.connect(g).connect(audio.destination);
    o.start();o.stop(audio.currentTime+.03);
}
function bell(){
    if(!soundEnabled)return;
    const o=audio.createOscillator(),g=audio.createGain();
    o.frequency.value=1200;
    g.gain.exponentialRampToValueAtTime(.001,audio.currentTime+.6);
    o.connect(g).connect(audio.destination);
    o.start();o.stop(audio.currentTime+.7);
}

/* COIN */
function coinFlip(){
    coinLog.innerHTML='';
    coin.classList.remove('toss');void coin.offsetWidth;coin.classList.add('toss');
    clickSound(2000);
    setTimeout(()=>{
        showLog(
            'coinLog',
            Math.random()<.5
            ?`–û—Ä—ë–ª ‚Üí <span class="movie">${eagleText.value}</span>`
            :`–†–µ—à–∫–∞ ‚Üí <span class="movie">${tailsText.value}</span>`
        );
    },1100);
}

/* DICE */
function rollDice(){
    diceLog.innerHTML='';
    dice.classList.remove('roll');void dice.offsetWidth;dice.classList.add('roll');
    clickSound(600);
    const min=+diceMin.value,max=+diceMax.value;
    const n=Math.floor(Math.random()*(max-min+1))+min;
    setTimeout(()=>{
        showLog('diceLog',`–í—ã–ø–∞–ª–æ: <span class="movie">${n}</span>`);
    },1100);
}

/* WHEEL */
const ctx=wheel.getContext('2d');
let sectors=[],angle=0,spinning=false,blinking=false,history=[];
let highlightIndex=null,blinkPhase=0;

function draw(){
    ctx.clearRect(0,0,260,260);
    const cx=130,cy=130,r=130;

    ctx.beginPath();
    ctx.arc(cx,cy,r,0,Math.PI*2);
    ctx.fillStyle='#252833';
    ctx.fill();

    if(sectors.length){
        const step=2*Math.PI/sectors.length;
        sectors.forEach((t,i)=>{
            const start=i*step+angle;
            ctx.beginPath();
            ctx.moveTo(cx,cy);
            ctx.arc(cx,cy,r,start,start+step);
            ctx.closePath();
            ctx.fillStyle=`hsl(${i*360/sectors.length},70%,45%)`;
            ctx.fill();

            ctx.save();
            ctx.translate(cx,cy);
            ctx.rotate(start+step/2);
            ctx.textAlign="right";
            ctx.textBaseline="middle";
            ctx.fillStyle="#fff";
            ctx.font="14px system-ui";

            let label=t;
            while(ctx.measureText(label+"‚Ä¶").width>90 && label.length){
                label=label.slice(0,-1);
            }
            if(label!==t)label+="‚Ä¶";

            ctx.fillText(label,r-16,0);
            ctx.restore();
        });
    }

    ctx.save();
    ctx.globalCompositeOperation='destination-out';
    ctx.beginPath();
    ctx.arc(cx,cy,14,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    ctx.beginPath();
    ctx.arc(cx,cy,14,0,Math.PI*2);
    ctx.strokeStyle="#ffd66b";
    ctx.lineWidth=2;
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(cx,cy,r-1,0,Math.PI*2);
    ctx.strokeStyle="#ffd66b";
    ctx.lineWidth=2;
    ctx.stroke();
}
draw();

function updateHistory(){
    wheelHistory.innerHTML='';
    history.forEach((h,i)=>{
        const li=document.createElement('li');
        li.innerHTML=`${i+1}. `+(isURL(h)?formatLink(h):h);
        wheelHistory.appendChild(li);
    });
}

function spinWheel(){
    if(sectors.length<2||spinning||blinking)return;

    spinning=true;
    let speed=Math.random()*.4+.3,last=null;

    const spin=setInterval(()=>{
        angle+=speed;
        speed*=.985;
        draw();

        const step=2*Math.PI/sectors.length;
        const idx=Math.floor(((2*Math.PI-((angle+Math.PI/2)%(2*Math.PI)))%(2*Math.PI))/step);
        if(idx!==last){clickSound();last=idx}

        if(speed<.005){
            clearInterval(spin);
            spinning=false;

            const result=sectors[idx];
            lastResult.innerHTML=`–í—ã–ø–∞–ª–æ: <span>${isURL(result)?formatLink(result):result}</span>`;

            history.push(result);
            updateHistory();

            sectors.splice(idx,1);
            draw();
            bell();
        }
    },20);
}

function addSector(){
    if(!sectorInput.value.trim()||spinning||blinking)return;
    sectors.push(sectorInput.value.trim());
    sectorInput.value='';
    draw();
}
function resetWheel(){
    if(spinning||blinking)return;
    sectors=[];history=[];
    lastResult.innerHTML='–í—ã–ø–∞–ª–æ: <span></span>';
    updateHistory();
    draw();
}
</script>
</body>
</html>
